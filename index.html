<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regional Map Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .search-container {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .search-box {
            display: flex;
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 50px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.2);
        }
        
        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .main-content {
            display: flex;
            height: 600px;
        }
        
        .map-container {
            flex: 1;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .info-panel {
            width: 400px;
            background: white;
            border-left: 1px solid #e9ecef;
            overflow-y: auto;
        }
        
        .info-content {
            padding: 30px;
        }
        
        .info-title {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .info-text {
            color: #555;
            line-height: 1.8;
            margin-bottom: 20px;
        }
        
        .region-stats {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .stat-label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-value {
            color: #667eea;
            font-weight: bold;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }
        
        .loading::after {
            content: '';
            display: inline-block;
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        
        .error {
            color: #e74c3c;
            background: #fdf2f2;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #e74c3c;
        }

        .search-suggestion {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #2196f3;
        }
        
        .suggestion-title {
            font-weight: bold;
            color: #1565c0;
            margin-bottom: 5px;
        }

        .coordinates-info {
            background: #f0f8f0;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #4caf50;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Regional Map Explorer</h1>
            <p>Search for any address and discover which region it belongs to</p>
        </div>
        
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="addressInput" class="search-input" 
                       placeholder="Enter an address (e.g., 1125 B St, San Rafael)">
                <button id="searchBtn" class="search-btn">Search</button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="map-container">
                <div id="map"></div>
            </div>
            
            <div class="info-panel">
                <div class="info-content" id="infoContent">
                    <div class="info-title">Welcome to Regional Explorer</div>
                    <div class="info-text">
                        Enter any address in Marin County into the search box above to discover which historic rancho it belongs to.
                    </div>
                    <div class="info-text">
                        The map shows the original ranchos of Marin County with detailed information about each one.
                    </div>
                    <div class="info-text">
                        Click on any rancho polygon or search for an address to get detailed information!
                    </div>
                    <div class="info-text">
                        This system uses free OpenStreetMap data integrated using Leaflet.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
        let map;
        let regions = [];
        let currentMarker;
        let highlightedRegion = null;

        // Enhanced region data with proper statistics and information
        const regionData = {
            'Corte Madera de Novato': {
                coordinates: [
                    [38.168250396984384, -122.69407654122918],
                    [38.13396247671964, -122.72497558908073],
                    [38.12045887373562, -122.7016296418151],
                    [38.112355513009696, -122.7016296418151],
                    [38.11208538550022, -122.69407654122918],
                    [38.111274996977635, -122.68824005441276],
                    [38.1066826255182, -122.6848068268737],
                    [38.10560202557017, -122.67759704904168],
                    [38.102630293298475, -122.67382049874871],
                    [38.102630293298475, -122.65871429757682],
                    [38.10587217705566, -122.65356445626824],
                    [38.104791565119946, -122.63227844552605],
                    [38.10803335297616, -122.63227844552605],
                    [38.110464599463874, -122.62712860421745],
                    [38.120999065813564, -122.62678528146354],
                    [38.12153925389513, -122.63021850900262],
                    [38.136122821387204, -122.63021850900262],
                    [38.139093190885205, -122.63605499581902],
                    [38.14557357737077, -122.63365173654168],
                    [38.15016350287313, -122.64189148263542],
                    [38.14692358543955, -122.65459442452996],
                    [38.15124344337197, -122.66626739816276],
                    [38.1496235266276, -122.67450714425652],
                    [38.168250396984384, -122.69407654122918]
                ],
                color: '#e74c3c',
                info: {
                    title: 'Corte Madera de Novato',
                    stats: {
                        'Grant Date': 'October 2, 1834',
                        'Original Grantee': 'John Reed',
                        'Size': '4460.24 acres',
                        'Governor': 'Jose Figuero',
                    },
                    description: 'At the age of 15, John Reed left Dublin, Ireland, with a seafaring uncle, and made his way to Acapulco, Mexico. In 1825, Reed boarded a Mexican vessel and sailed along the California coast—stopping briefly at Los Angeles—and, in 1826, like William Richardson before him, parted company with his shipmates at Yerba Buena. Upon his arrival in the Bay Area, he built a dwelling in Sausalito and applied to the governor for a land grant in the area. His request having been denied, he traveled north and set up a ranch in what is now Cotati. After an Indian tribe burned his grain, he came back to Sausalito in 1832. He established a ferry service on the bay, which he used, among other things, to transport barrels of spring water from Sausalito to Yerba Buena. \n In 1834, Governor Figueroa awarded him the first land grant in Marin, Rancho Corte Madera del Presidio—consisting of nearly 5000 acres. On his new rancho, Reed built a sawmill (the first in the county, and the namesake for the future Mill Valley) and cut wood for the San Francisco Presidio (hence, “Corte Madera del Presidio”). He also raised cattle and horses and had a brickyard and stone quarry. In addition, he hunted elk, deer, bear and other game, and established a trade in skins, tallow and other rancho products. In 1836, he married Hilaria Sanchez, the daughter of the commandant of the local presidio, in a ceremony at Mission Dolores. At the behest of Mexican authorities, Reed served as administrator of the San Rafael mission from late 1836 to April of 1837. He then set out to build a larger house for his growing family in what is now Mill Valley (at La Goma and Locke Lane) but died in 1843, at the age of 38, before his house was finished. \n On Reed’s death, in accordance with Mexican law, his wife inherited the house and livestock and the land was divided up among the four children, all of whom were minors at the time. The Widow Reed, as she was called, had a difficult time maintaining control of the family’s land and livestock, which fell prey to squatters and cattle rustlers. Several years later, she married Benardino Garcia, and in 1846 during the Bear Flag revolt, fled with her children to Mission Dolores. After the Reeds were settled in San Francisco, an administrator sold rancho Corte Madera del Presidio to Benjamin Bucklew on credit. When no payments were received, Hilaria protested, and the rancho returned to the Reed family. The Reed claim was confirmed by the Land Commission in 1856, although the actual acreage they were given was far less than what had been included in the original Diseño. It is to the credit of Widow Reed that she managed to keep what remained of the family rancho going until her death in 1868. In the following decades, numerous additional court cases involving the Reed claim ensued and the Reeds ended up gaining back several thousand of their “lost” acres. Descendents of John Reed (such as the Lyfords and Deffebachs) continued to live on parts of the rancho Corte Madera del Presidio, through the 20th Century.',
                }
            },
            'Soullajule': {
                coordinates: [
                    [38.134070493823586, -122.72525024571226],
                    [38.12340287045033, -122.76044082798765],
                    [38.14554657530658, -122.78790664830015],
                    [38.15769575300814, -122.82103729405208],
                    [38.16889820084662, -122.83992004551695],
                    [38.18109746185443, -122.86127472238152],
                    [38.19480570412978, -122.87226105050651],
                    [38.20883508601526, -122.86505127267449],
                    [38.20910485532582, -122.85234833077995],
                    [38.20505821068454, -122.84410858468621],
                    [38.20020194017038, -122.83449554757682],
                    [38.20397906745351, -122.8279724152526],
                    [38.20397906745351, -122.81423950509635],
                    [38.20236032261288, -122.80840301827995],
                    [38.19750387213767, -122.80290985421746],
                    [38.18563118511921, -122.80016327218621],
                    [38.1807736189769, -122.78608703927604],
                    [38.17888447801048, -122.77819061593621],
                    [38.17456625759166, -122.77132416085807],
                    [38.15702085590265, -122.76205444650262],
                    [38.164579392822404, -122.73527527169793],
                    [38.16862828670254, -122.6951065094909],
                    [38.134070493823586, -122.72525024571226]
                ],
                color: '#2ecc71',
                info: {
                    title: 'Soullajule',
                    description: 'Historic Mexican land grant in western Marin County, known for its rugged coastal terrain.',
                    details: 'Granted to Manuel Cabello Torrejon in 1846, this rancho covered the coastal hills and valleys of western Marin. The name is derived from the Coast Miwok word for the area.',
                    features: 'Encompasses parts of present-day Lucas Valley and coastal hills. Now includes the Soullajule Reservoir and surrounding parklands.',
                    stats: {
                        'Grant Year': '1846',
                        'Original Grantee': 'Manuel Cabello Torrejon',
                        'Approximate Acres': '17,700',
                        'Notable Features': 'Soullajule Reservoir'
                    }
                }
            },
            'Laguna de San Antonio': {
                coordinates: [
                    [38.266165545687045, -122.80325317697137],
                    [38.2607742017911, -122.81835937814323],
                    [38.157992709215904, -122.76171112374871],
                    [38.18444380750062, -122.6734771759948],
                    [38.186062950631374, -122.67553711251824],
                    [38.191729668183555, -122.67279053048699],
                    [38.190650327400974, -122.6786270173034],
                    [38.194158126461524, -122.68103027658073],
                    [38.197395944866685, -122.68652344064323],
                    [38.19766575656877, -122.6902999909362],
                    [38.197395944866685, -122.69750976876824],
                    [38.20063361930768, -122.69956970529168],
                    [38.20063361930768, -122.70300293283073],
                    [38.19793556727113, -122.70574951486198],
                    [38.20360136107342, -122.71124267892448],
                    [38.20845740483092, -122.71295929269402],
                    [38.20953648167321, -122.71536255197137],
                    [38.2157408630576, -122.71398926095574],
                    [38.266165545687045, -122.80325317697137]
                ],
                color: '#9b59b6',
                info: {
                    title: 'Laguna de San Antonio',
                    description: 'Northernmost Mexican land grant in Marin County, extending into Sonoma County.',
                    details: 'Granted to Rafael Cacho in 1845, this rancho was named after a lagoon (now drained) that existed in the area. It represents the northern boundary of Mexican land grants in Marin.',
                    features: 'Covers parts of modern Petaluma and rural northern Marin. Known for its rolling hills and agricultural use.',
                    stats: {
                        'Grant Year': '1845',
                        'Original Grantee': 'Rafael Cacho',
                        'Approximate Acres': '17,200',
                        'Counties': 'Marin, Sonoma'
                    }
                }
            },
            'Buacocha': {
                coordinates: [
                    [38.188059842616006,-122.65768432931512],
                    [38.189948745667955,-122.65940094308463],
                    [38.189948745667955,-122.66489410714713],
                    [38.19183759973514,-122.66935730294792],
                    [38.19156776643893,-122.6731338532409],
                    [38.186440743869994,-122.67450714425652],
                    [38.18428188956117,-122.67244720773309],
                    [38.16538918547039,-122.73355865792838],
                    [38.16916811810983,-122.69476318673699],
                    [38.15081146744334,-122.67382049874871],
                    [38.151891398348354,-122.66558075265495],
                    [38.188059842616006,-122.65768432931512]
                ],
                color: '#1abc9c',
                info: {
                    title: 'Rancho de Buacocha',
                    description: 'Small but significant Mexican land grant in central Marin County.',
                    details: 'Granted to John Thomas Reed in 1834, this was one of the first Mexican land grants in Marin County. The name comes from the Coast Miwok village that once existed here.',
                    features: 'Located near present-day Mill Valley and Corte Madera. Known for its redwood groves and creek systems.',
                    stats: {
                        'Grant Year': '1834',
                        'Original Grantee': 'John Thomas Reed',
                        'Approximate Acres': '8,800',
                        'Significance': 'First land grant in Marin'
                    }
                }
            },
            'Olompali': {
                coordinates: [
                    [38.18730427097376,-122.6569976838073],
                    [38.18730427097376,-122.65184784249871],
                    [38.18541529934465,-122.64704132394401],
                    [38.18082759288977,-122.64257812814323],
                    [38.18136733805533,-122.63124847726434],
                    [38.17839869016438,-122.63090515451043],
                    [38.17839869016438,-122.62369537667838],
                    [38.182716683475874,-122.6188888581237],
                    [38.182986549561086,-122.60858917550652],
                    [38.180557718807606,-122.60687256173699],
                    [38.18001796764441,-122.59657287911979],
                    [38.18730427097376,-122.59210968331902],
                    [38.18838366134068,-122.5855865509948],
                    [38.184605725080246,-122.58524322824088],
                    [38.184335864992796,-122.5807800324401],
                    [38.1819070792224,-122.57563019113151],
                    [38.18082759288977,-122.57151031808465],
                    [38.17677937669912,-122.5687637360534],
                    [38.17704926477563,-122.56498718576043],
                    [38.17462023610256,-122.56498718576043],
                    [38.173810541886084,-122.56739044503777],
                    [38.164633378729604,-122.56773376779168],
                    [38.16544317489673,-122.56258392648307],
                    [38.1624738783073,-122.56155395822135],
                    [38.15923450773959,-122.56670379952996],
                    [38.15869459865288,-122.5584640534362],
                    [38.15329528791563,-122.55640411691276],
                    [38.149515532546694,-122.55709076242057],
                    [38.146815587361345,-122.55949402169792],
                    [38.14411554224382,-122.55743408517448],
                    [38.141145377195535,-122.55743408517448],
                    [38.138715152221245,-122.55777740792838],
                    [38.134394552417376,-122.55537414865104],
                    [38.13223415659008,-122.55915069894401],
                    [38.128993442945735,-122.55709076242057],
                    [38.12494234855876,-122.56052398995963],
                    [38.14276548221118,-122.58386993722526],
                    [38.14438555125244,-122.58970642404168],
                    [38.14762558140994,-122.59348297433465],
                    [38.14546557729398,-122.60103607492057],
                    [38.149245542525186,-122.60790252999871],
                    [38.1516754167422,-122.61408233956902],
                    [38.1516754167422,-122.61991882638542],
                    [38.14843556646459,-122.62163544015495],
                    [38.149515532546694,-122.62712860421745],
                    [38.14627558633235,-122.63330841378777],
                    [38.15059548263928,-122.64154815988151],
                    [38.14789557742748,-122.65390777902215],
                    [38.15194539776953,-122.66489410714713],
                    [38.18730427097376,-122.6569976838073]
                ],
                color: '#f39c12',
                info: {
                    title: 'Rancho Olompali',
                    description: 'Historic Mexican land grant with significant indigenous and Mexican-era history.',
                    details: 'Granted to Camilo Ynitia in 1843, this rancho is unique as Ynitia was a Coast Miwok leader. The site includes important archaeological remains and was later famous as a hippie commune in the 1960s.',
                    features: 'Now Olompali State Historic Park. Contains archaeological evidence of 6,000 years of human habitation, including Coast Miwok village sites.',
                    stats: {
                        'Grant Year': '1843',
                        'Original Grantee': 'Camilo Ynitia (Coast Miwok)',
                        'Approximate Acres': '8,900',
                        'Current Status': 'State Historic Park'
                    }
                }
            },
            'Bolsa de Tomales': {
                coordinates: [
                    [38.270963503990465, -122.81046295480338],
                    [38.26718985455903, -122.80290985421746],
                    [38.260989861995206, -122.81870270089715],
                    [38.21110111344384, -122.79261017160026],
                    [38.2097522938871, -122.7946701081237],
                    [38.21218015109167, -122.7998199494323],
                    [38.211370874355616, -122.80634308175652],
                    [38.214338178393135, -122.81286621408073],
                    [38.21325917274147, -122.81870270089715],
                    [38.217575099357695, -122.82659912423699],
                    [38.21406842848005, -122.82934570626823],
                    [38.21325917274147, -122.83758545236198],
                    [38.21325917274147, -122.84170532540887],
                    [38.2154171680465, -122.84754181222527],
                    [38.211640634267496, -122.84925842599479],
                    [38.211640634267496, -122.85200500802604],
                    [38.2154171680465, -122.85303497628776],
                    [38.21865404101527, -122.85612488107292],
                    [38.21703562252938, -122.85784149484245],
                    [38.2154171680465, -122.85681152658073],
                    [38.2154171680465, -122.85921478585807],
                    [38.21811457218635, -122.86779785470574],
                    [38.21703562252938, -122.87054443673698],
                    [38.21811457218635, -122.87363434152213],
                    [38.21703562252938, -122.87672424630729],
                    [38.21379867756707, -122.87500763253776],
                    [38.2097522938871, -122.87603760079948],
                    [38.20894299015477, -122.87912750558463],
                    [38.21218015109167, -122.88084411935417],
                    [38.21406842848005, -122.87809753732292],
                    [38.2154171680465, -122.88084411935417],
                    [38.21406842848005, -122.88977051095574],
                    [38.21865404101527, -122.88874054269402],
                    [38.224048509316994, -122.89148712472526],
                    [38.22728499830384, -122.89183044747917],
                    [38.23079103220567, -122.88977051095574],
                    [38.23186977786691, -122.8935470612487],
                    [38.23025165337485, -122.89766693429557],
                    [38.22485764506352, -122.89835357980338],
                    [38.22755469921946, -122.90213013009635],
                    [38.22728499830384, -122.90487671212762],
                    [38.2237787954015, -122.9038467438659],
                    [38.226745593472614, -122.90796661691277],
                    [38.22971227054393, -122.90796661691277],
                    [38.23429689710207, -122.9096832306823],
                    [38.23483624593148, -122.91414642648307],
                    [38.22863349288181, -122.91689300851432],
                    [38.22593647872582, -122.91620636300651],
                    [38.222430210824626, -122.91963959054557],
                    [38.2262061846414, -122.91963959054557],
                    [38.224048509316994, -122.92307281808463],
                    [38.21919350584448, -122.92684936837762],
                    [38.2164961417014, -122.93062591867059],
                    [38.21218015109167, -122.93440246896354],
                    [38.21487767521961, -122.93680572824088],
                    [38.217844836271986, -122.93989563302604],
                    [38.221890769994125, -122.94435882882682],
                    [38.21951718302793, -122.94772339024351],
                    [38.21628034845609, -122.95046997227473],
                    [38.21547111731498, -122.95252990879817],
                    [38.21924745231321, -122.95476150669859],
                    [38.22207957494555, -122.95373153843687],
                    [38.22531615153073, -122.95252990879817],
                    [38.226934385824315, -122.95373153843687],
                    [38.229901055195526, -122.95252990879817],
                    [38.23286760356374, -122.95476150669859],
                    [38.23542952522925, -122.95733642735289],
                    [38.23448566985312, -122.95939636387632],
                    [38.23313728377876, -122.95922470249934],
                    [38.23448566985312, -122.96094131626887],
                    [38.23381147994112, -122.96317291416929],
                    [38.230710125841824, -122.96282959141539],
                    [38.2317888727031, -122.96832275547789],
                    [38.230575281359116, -122.97381591954036],
                    [38.232597922348646, -122.97467422642515],
                    [38.23529468949701, -122.97312927403254],
                    [38.23947448093727, -122.97124099888609],
                    [38.243519211621596, -122.9710693375091],
                    [38.24823777967152, -122.96866607823179],
                    [38.25309084439418, -122.96866607823179],
                    [38.25565205345609, -122.97021103062437],
                    [38.25929151104565, -122.9707260147552],
                    [38.26090898923661, -122.97450256504817],
                    [38.26643510135025, -122.9774208084564],
                    [38.27007401877713, -122.97827911534117],
                    [38.26950797708357, -122.9757814411278],
                    [38.26977752137082, -122.97475147286607],
                    [38.271057843073976, -122.97333526650621],
                    [38.27291090030011, -122.97230529824449],
                    [38.27348365387659, -122.97045993844225],
                    [38.273079357703295, -122.96887207070543],
                    [38.27193383965554, -122.96775627175523],
                    [38.27092307343127, -122.96745586434557],
                    [38.27001337180154, -122.96505260506822],
                    [38.26927212501166, -122.9644947055931],
                    [38.268463483521906, -122.96496677437975],
                    [38.26782330262413, -122.96496677437975],
                    [38.26768852697931, -122.96415138283919],
                    [38.26789069035279, -122.96342182198714],
                    [38.26755375108438, -122.96264934579085],
                    [38.266778784835346, -122.96161937752913],
                    [38.26640814588035, -122.96067523995592],
                    [38.266778784835346, -122.95960235634993],
                    [38.26765483302902, -122.95938777962877],
                    [38.26853087065659, -122.95973110238268],
                    [38.26906996548327, -122.96063232461165],
                    [38.26964274935224, -122.96114730874254],
                    [38.27065353339558, -122.9611043933983],
                    [38.27196753162074, -122.96067523995592],
                    [38.27314674055517, -122.96093273202132],
                    [38.27462914747738, -122.9596452716942],
                    [38.27429223947054, -122.95840072671129],
                    [38.27301197478893, -122.95724201241686],
                    [38.27274244250616, -122.9561691288109],
                    [38.27294459181201, -122.95453834572984],
                    [38.27479760089464, -122.95299339333727],
                    [38.27654949326836, -122.95153427163314],
                    [38.27718959724613, -122.95041847268294],
                    [38.277324355259246, -122.9490022663231],
                    [38.277324355259246, -122.94767189065169],
                    [38.277998141573214, -122.94629859963607],
                    [38.27772862779792, -122.94496822396471],
                    [38.27692008046961, -122.94458198586653],
                    [38.27594307376836, -122.94423866311263],
                    [38.27446069366935, -122.94380950967025],
                    [38.27260767598961, -122.94273662606429],
                    [38.27216968308367, -122.94183540383531],
                    [38.27260767598961, -122.93951797524645],
                    [38.2736184187675, -122.93810176888658],
                    [38.274494384462216, -122.93664264718248],
                    [38.274393312036715, -122.93488311806871],
                    [38.2737531834083, -122.93372440377425],
                    [38.2732141233445, -122.93175029793932],
                    [38.273416271337375, -122.93089199105452],
                    [38.273652109951136, -122.93020534554671],
                    [38.2736184187675, -122.92930412331773],
                    [38.27291090030011, -122.92866039315416],
                    [38.272371833983925, -122.92831707040025],
                    [38.2705187630026, -122.92775917092513],
                    [38.268598257728755, -122.92797374764635],
                    [38.267418974939375, -122.92818832436751],
                    [38.26563316740852, -122.92814540902327],
                    [38.26445383647816, -122.9278450016136],
                    [38.26391470739011, -122.92655754128648],
                    [38.262465778139614, -122.92466926613997],
                    [38.26229729611866, -122.92385387459947],
                    [38.26276904479271, -122.92278099099352],
                    [38.26418427243429, -122.92192268410872],
                    [38.26634075677624, -122.92127895394518],
                    [38.26789069035279, -122.92162227669908],
                    [38.26944059085547, -122.92123603860091],
                    [38.270788303538474, -122.92218017617415],
                    [38.27193383965554, -122.92200851479723],
                    [38.27270875090047, -122.92054939309313],
                    [38.272405525745896, -122.9179744724388],
                    [38.271799071638455, -122.9176311496849],
                    [38.271192612466585, -122.9179744724388],
                    [38.2705187630026, -122.91780281106188],
                    [38.26937320456483, -122.91703033486556],
                    [38.26883411198894, -122.9159574512596],
                    [38.269171045317805, -122.91432666817857],
                    [38.26906996548327, -122.91325378457262],
                    [38.269171045317805, -122.91235256234361],
                    [38.26977752137082, -122.91196632424547],
                    [38.26997967892976, -122.91153717080309],
                    [38.269811214336386, -122.91007804909898],
                    [38.27018183592599, -122.90960598031234],
                    [38.270451377712334, -122.90896225014876],
                    [38.2700807574982, -122.90780353585436],
                    [38.27031660694419, -122.90698814431383],
                    [38.27011445032311, -122.90651607552718],
                    [38.271192612466585, -122.90522861520006],
                    [38.271192612466585, -122.90492820779039],
                    [38.27146215050152, -122.90501403847887],
                    [38.27200122357031, -122.90475654641341],
                    [38.27227075860413, -122.90376949349593],
                    [38.27200122357031, -122.90346908608629],
                    [38.27213599121227, -122.90278244057848],
                    [38.27200122357031, -122.90231037179183],
                    [38.27159691914385, -122.90188121834947],
                    [38.271057843073976, -122.90222454110338],
                    [38.26997967892976, -122.90200996438216],
                    [38.2702087899954, -122.89862823643492],
                    [38.27007401877713, -122.89450836338804],
                    [38.270963503990465, -122.81046295480338]
                ],
                color: '#12f39c',
                info: {
                    title: 'Bolsa de Tomales',
                    description: 'Historic Mexican land grant with significant indigenous and Mexican-era history.',
                    details: 'Granted to Camilo Ynitia in 1843, this rancho is unique as Ynitia was a Coast Miwok leader. The site includes important archaeological remains and was later famous as a hippie commune in the 1960s.',
                    features: 'Now Olompali State Historic Park. Contains archaeological evidence of 6,000 years of human habitation, including Coast Miwok village sites.',
                    stats: {
                        'Grant Year': '1843',
                        'Original Grantee': 'Camilo Ynitia (Coast Miwok)',
                        'Approximate Acres': '8,900',
                        'Current Status': 'State Historic Park'
                    }
                }
            },
            'Blucher': {
                coordinates: [
                    [38.271826022023056,-122.8114929230651],
                    [38.3169862362226,-122.88764190830989],
                    [38.31456187928551,-122.89227676548765],
                    [38.319410512098735,-122.89519500889585],
                    [38.31604344037923,-122.9030914322357],
                    [38.31806370217516,-122.90446472325132],
                    [38.32008390767828,-122.90034485020445],
                    [38.321700031549305,-122.90034485020445],
                    [38.322508079974156,-122.90446472325132],
                    [38.32210405688764,-122.90875625767515],
                    [38.32008390767828,-122.9144210831146],
                    [38.318333066161394,-122.91665268101497],
                    [38.3169862362226,-122.91648101963804],
                    [38.3140231222914,-122.91270446934507],
                    [38.3098476198646,-122.91545105137632],
                    [38.31146397190486,-122.91648101963804],
                    [38.31294559629444,-122.91630935826106],
                    [38.31456187928551,-122.91854095616148],
                    [38.3146965679086,-122.92094421543882],
                    [38.31011701437304,-122.92746734776301],
                    [38.31079049626615,-122.92884063877864],
                    [38.313619051918884,-122.92660904087828],
                    [38.31504675797981,-122.92726135332488],
                    [38.31558550736835,-122.92949295122527],
                    [38.31450800458832,-122.93155288774871],
                    [38.31262233619518,-122.932325363945],
                    [38.31100600997312,-122.93352699358368],
                    [38.309659043935405,-122.93481445391082],
                    [38.31033253008142,-122.93687439043426],
                    [38.31141009490603,-122.9367027290573],
                    [38.31235295099327,-122.93395614702605],
                    [38.31343048579658,-122.93361282427215],
                    [38.314171281685915,-122.93429946977996],
                    [38.31316110359684,-122.93773269731902],
                    [38.31235295099327,-122.93756103594207],
                    [38.312016218083656,-122.93824768144988],
                    [38.31080396666233,-122.93979263384247],
                    [38.31093866226541,-122.9407367714157],
                    [38.31167948361042,-122.94185257036591],
                    [38.3119488713141,-122.94296836931609],
                    [38.312891720396365,-122.94382667620086],
                    [38.31282437443989,-122.94459915239715],
                    [38.31141009490603,-122.94562912065886],
                    [38.31107335761831,-122.94777488787079],
                    [38.31174683063016,-122.94940567095183],
                    [38.312891720396365,-122.95086479265593],
                    [38.31329579482182,-122.9520664222946],
                    [38.31316110359684,-122.954298020195],
                    [38.313767212139,-122.95644378740691],
                    [38.315114101872275,-122.95858955461884],
                    [38.31625893847484,-122.96047782976531],
                    [38.31686502112296,-122.9623661049118],
                    [38.31747109870478,-122.9649410255661],
                    [38.316595651682604,-122.96751594622039],
                    [38.31497941402479,-122.96768760759736],
                    [38.313497831190176,-122.96751594622039],
                    [38.31268968233931,-122.96863174517058],
                    [38.31120805272103,-122.96880340654754],
                    [38.310265181748285,-122.97000503618621],
                    [38.30999578779021,-122.97094917375945],
                    [38.31060192278862,-122.97240829546355],
                    [38.31141009490603,-122.97395324785614],
                    [38.31174683063016,-122.97472572405242],
                    [38.31100600997312,-122.9766139991989],
                    [38.31093866226541,-122.97875976641082],
                    [38.31114070520092,-122.98124885637664],
                    [38.31114070520092,-122.98253631670379],
                    [38.30986109043591,-122.98365211565398],
                    [38.30817735239895,-122.98425293047332],
                    [38.308244702670926,-122.98622703630829],
                    [38.30831205288039,-122.98734283525847],
                    [38.307638547971465,-122.98888778765105],
                    [38.30635887141421,-122.99034690935517],
                    [38.30528123153858,-122.99120521623992],
                    [38.30629151939104,-122.99249267656708],
                    [38.306426223374835,-122.99369430620574],
                    [38.30629151939104,-122.99489593584443],
                    [38.30541593739859,-122.99541091997527],
                    [38.304068867540956,-122.99420929033661],
                    [38.302519706278495,-122.99412345964812],
                    [38.30097051193265,-122.99395179827117],
                    [38.29975807588951,-122.99420929033661],
                    [38.29908449155465,-122.99515342790984],
                    [38.29881505606965,-122.99781417925261],
                    [38.298006743611055,-122.99995994646453],
                    [38.29686161887929,-123.00304985124968],
                    [38.2941401925639,-123.00133323748015],
                    [38.292590819287426,-122.99978828508759],
                    [38.291647706314,-122.99978828508759],
                    [38.29104141293028,-123.000045777153],
                    [38.29030038080481,-122.99918747026824],
                    [38.28989617827445,-122.99755668718718],
                    [38.28915513445528,-122.99695587236785],
                    [38.288481451690146,-122.99687004167937],
                    [38.288077239029484,-122.99781417925261],
                    [38.28733617663825,-122.99695587236785],
                    [38.286797217419505,-122.99618339617156],
                    [38.28639299537911,-122.99669838030243],
                    [38.28571928697598,-122.99626922686005],
                    [38.2855171732357,-122.99523925859833],
                    [38.28403498861103,-122.99515342790984],
                    [38.28268752178058,-122.99463844377898],
                    [38.2826201477825,-122.99378013689422],
                    [38.281744280117316,-122.99257850725554],
                    [38.28134002993848,-122.99060440142058],
                    [38.2810031530699,-122.98948860247039],
                    [38.27999251308498,-122.98897361833954],
                    [38.27844283778345,-122.98888778765105],
                    [38.27736478328268,-122.989059449028],
                    [38.27608457277299,-122.98802948076629],
                    [38.274804339691485,-122.98751449663543],
                    [38.273726231168474,-122.98674202043914],
                    [38.27285025620763,-122.98648452837371],
                    [38.27285025620763,-122.98416709978484],
                    [38.272243805814085,-122.98262214739226],
                    [38.27076135019825,-122.98167800981903],
                    [38.27008749673279,-122.98133468706513],
                    [38.27035703886923,-122.97824478227996],
                    [38.27096350501868,-122.97695732195281],
                    [38.27143519741139,-122.9751548774948],
                    [38.27278287308068,-122.97309494097136],
                    [38.27453481406132,-122.97172164995574],
                    [38.27399575979982,-122.9696617134323],
                    [38.27244595650799,-122.9678592689743],
                    [38.271704734546006,-122.96700096208954],
                    [38.270559194815085,-122.96468353350066],
                    [38.26873977104514,-122.96485519487761],
                    [38.267796348183566,-122.96442604143523],
                    [38.2676615724887,-122.9627094276657],
                    [38.26692030169673,-122.96176529009247],
                    [38.267257243903614,-122.95927620012665],
                    [38.26853761003497,-122.95936203081513],
                    [38.26914409137737,-122.96116447527312],
                    [38.27109827458634,-122.96082115251922],
                    [38.27244595650799,-122.96056366045379],
                    [38.273456701536716,-122.96090698320769],
                    [38.27460219556265,-122.95996284563445],
                    [38.27453481406132,-122.95893287737275],
                    [38.27359146647764,-122.95764541704558],
                    [38.272715489891176,-122.95627212602996],
                    [38.273456701536716,-122.95404052812958],
                    [38.27500648325761,-122.9528388984909],
                    [38.27689312940521,-122.95129394609833],
                    [38.277634298408515,-122.94974899370574],
                    [38.27756691972085,-122.9484615333786],
                    [38.27770167703366,-122.94717407305144],
                    [38.278038569221465,-122.94597244341277],
                    [38.27709526715641,-122.94459915239715],
                    [38.27608457277299,-122.94425582964324],
                    [38.274063141801335,-122.94356918413543],
                    [38.27278287308068,-122.94185257036591],
                    [38.27278287308068,-122.94005012590789],
                    [38.27379361342009,-122.93824768144988],
                    [38.27453481406132,-122.93661689836884],
                    [38.274063141801335,-122.93447113115691],
                    [38.27352408403845,-122.93249702532195],
                    [38.27352408403845,-122.93112373430633],
                    [38.274063141801335,-122.92957878191375],
                    [38.27298502227399,-122.92854881365203],
                    [38.27136781297143,-122.92769050676726],
                    [38.269346250699435,-122.9276046760788],
                    [38.266852913067765,-122.92777633745574],
                    [38.264359489844985,-122.92777633745574],
                    [38.26328122626727,-122.92588806230926],
                    [38.26274208847656,-122.92434310991668],
                    [38.26408992545103,-122.92202568132781],
                    [38.26631380178548,-122.92142486650847],
                    [38.26860499710088,-122.92142486650847],
                    [38.26981795359597,-122.92151069719695],
                    [38.270896120141046,-122.92219734270476],
                    [38.27204165455748,-122.92159652788544],
                    [38.27298502227399,-122.92056655962372],
                    [38.27251333994758,-122.91807746965789],
                    [38.271704734546006,-122.91739082415008],
                    [38.27130042846895,-122.91781997759247],
                    [38.27028965342891,-122.9176483162155],
                    [38.269278864321265,-122.91679000933074],
                    [38.26867238410427,-122.9161891945114],
                    [38.269211477880575,-122.91481590349578],
                    [38.269076704811624,-122.91232681352996],
                    [38.270154882360686,-122.91164016802215],
                    [38.269683181652425,-122.90992355425261],
                    [38.270559194815085,-122.90940857012177],
                    [38.27035703886923,-122.9074344642868],
                    [38.27022226792606,-122.90657615740203],
                    [38.27136781297143,-122.90494537432097],
                    [38.2721090383722,-122.90468788225554],
                    [38.272243805814085,-122.90322876055144],
                    [38.271704734546006,-122.90211296160126],
                    [38.270626580005306,-122.90202713091277],
                    [38.269346250699435,-122.90176963884736],
                    [38.2675941845475,-122.9008255012741],
                    [38.271826022023056,-122.8114929230651]
                ],
                color: '#1269f3',
                info: {
                    title: 'Blucher',
                    description: 'Historic Mexican land grant with significant indigenous and Mexican-era history.',
                    details: 'Granted to Camilo Ynitia in 1843, this rancho is unique as Ynitia was a Coast Miwok leader. The site includes important archaeological remains and was later famous as a hippie commune in the 1960s.',
                    features: 'Now Olompali State Historic Park. Contains archaeological evidence of 6,000 years of human habitation, including Coast Miwok village sites.',
                    stats: {
                        'Grant Year': '1843',
                        'Original Grantee': 'Camilo Ynitia (Coast Miwok)',
                        'Approximate Acres': '8,900',
                        'Current Status': 'State Historic Park'
                    }
                }
            }
        };

        function initMap() {
            // Initialize map centered on Marin County
            map = L.map('map').setView([38.0834, -122.7633], 10);

            // Add OpenStreetMap tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            // Create region polygons with enhanced functionality
            Object.keys(regionData).forEach(regionName => {
                const region = regionData[regionName];
                
                // Create polygon with improved styling
                const polygon = L.polygon(region.coordinates, {
                    color: region.color,
                    weight: 3,
                    opacity: 0.8,
                    fillColor: region.color,
                    fillOpacity: 0.2,
                    smoothFactor: 1
                }).addTo(map);

                // Store region data
                regions.push({
                    name: regionName,
                    polygon: polygon,
                    data: region
                });

                // Enhanced click listener
                polygon.on('click', (e) => {
                    clearHighlight();
                    highlightRegion(polygon, region.color);
                    showRegionInfo(regionName, region.info);
                    
                    // Center map on polygon
                    const bounds = polygon.getBounds();
                    map.fitBounds(bounds, { padding: [20, 20] });
                });

                // Enhanced hover effects
                polygon.on('mouseover', function() {
                    if (highlightedRegion !== polygon) {
                        polygon.setStyle({
                            weight: 4,
                            opacity: 1,
                            fillOpacity: 0.3
                        });
                    }
                });

                polygon.on('mouseout', function() {
                    if (highlightedRegion !== polygon) {
                        polygon.setStyle({
                            weight: 3,
                            opacity: 0.8,
                            fillOpacity: 0.2
                        });
                    }
                });

                // Improved tooltip
                polygon.bindTooltip(`<strong>${regionName}</strong><br>Click for details`, {
                    permanent: false,
                    direction: 'center',
                    className: 'custom-tooltip'
                });
            });

            // Search functionality
            document.getElementById('searchBtn').addEventListener('click', searchAddress);
            document.getElementById('addressInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchAddress();
                }
            });
        }

        async function searchAddress() {
            const address = document.getElementById('addressInput').value.trim();
            if (!address) {
                showError('Please enter an address to search.');
                return;
            }

            showLoading();
            clearHighlight();

            try {
                // Enhanced Nominatim query with better parameters
                const query = encodeURIComponent(address + ', Marin County, California');
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/search?format=json&q=${query}&limit=5&countrycodes=us&addressdetails=1`
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();

                if (data && data.length > 0) {
                    // Find the best match (preferring results in Marin County)
                    let bestResult = data.find(result => 
                        result.display_name.toLowerCase().includes('marin') ||
                        result.display_name.toLowerCase().includes('california')
                    ) || data[0];

                    const lat = parseFloat(bestResult.lat);
                    const lng = parseFloat(bestResult.lon);
                    const displayName = bestResult.display_name;

                    // Validate coordinates are reasonable for Marin County area
                    if (lat < 37.8 || lat > 38.3 || lng < -123.1 || lng > -122.4) {
                        showError('The address appears to be outside the Marin County area. Please try a different address.');
                        return;
                    }

                    // Clear previous marker
                    if (currentMarker) {
                        map.removeLayer(currentMarker);
                    }

                    // Add enhanced marker
                    currentMarker = L.marker([lat, lng], {
                        title: displayName
                    })
                        .addTo(map)
                        .bindPopup(`<strong>Found Location:</strong><br>${displayName}`)
                        .openPopup();

                    // Center map on result with appropriate zoom
                    map.setView([lat, lng], 15);

                    // Enhanced region detection
                    const foundRegion = findRegionContainingPoint(lat, lng);
                    
                    if (foundRegion) {
                        // Highlight the found region
                        highlightRegion(foundRegion.polygon, foundRegion.data.color);
                        
                        // Show region information with search context
                        showRegionInfo(foundRegion.name, foundRegion.data.info, {
                            address: displayName,
                            coordinates: [lat, lng]
                        });
                        
                        // Fit map to show both marker and region
                        const group = new L.featureGroup([currentMarker, foundRegion.polygon]);
                        map.fitBounds(group.getBounds(), { padding: [20, 20] });
                        
                    } else {
                        showNoRegionFound(displayName, lat, lng);
                    }
                } else {
                    showError('Address not found. Please try a more specific address or check the spelling.');
                }
            } catch (error) {
                console.error('Geocoding error:', error);
                showError('Search failed due to a network error. Please check your internet connection and try again.');
            }
        }

        // Enhanced point-in-polygon algorithm with better precision
        function findRegionContainingPoint(lat, lng) {
            for (let region of regions) {
                if (isPointInPolygon(lat, lng, region.data.coordinates)) {
                    return region;
                }
            }
            return null;
        }

        // Improved point-in-polygon algorithm (ray casting)
        function isPointInPolygon(lat, lng, coordinates) {
            let inside = false;
            const x = lat;
            const y = lng;
            
            for (let i = 0, j = coordinates.length - 1; i < coordinates.length; j = i++) {
                const xi = coordinates[i][0];
                const yi = coordinates[i][1];
                const xj = coordinates[j][0];
                const yj = coordinates[j][1];

                if (((yi > y) !== (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi)) {
                    inside = !inside;
                }
            }
            return inside;
        }

        // Enhanced region highlighting
        function highlightRegion(polygon, color) {
            clearHighlight();
            polygon.setStyle({
                weight: 5,
                opacity: 1,
                fillOpacity: 0.4,
                color: color
            });
            highlightedRegion = polygon;
        }

        function clearHighlight() {
            if (highlightedRegion) {
                const regionData = regions.find(r => r.polygon === highlightedRegion);
                if (regionData) {
                    highlightedRegion.setStyle({
                        weight: 3,
                        opacity: 0.8,
                        fillOpacity: 0.2,
                        color: regionData.data.color
                    });
                }
                highlightedRegion = null;
            }
        }

        // Enhanced region information display
        function showRegionInfo(regionName, info, searchContext = null) {
            const infoContent = document.getElementById('infoContent');
            
            let searchContextHTML = '';
            if (searchContext) {
                searchContextHTML = `
                    <div class="coordinates-info">
                        <strong>📍 Search Result:</strong><br>
                        ${searchContext.address}<br>
                        <small>Coordinates: ${searchContext.coordinates[0].toFixed(6)}, ${searchContext.coordinates[1].toFixed(6)}</small>
                    </div>
                `;
            }
            
            infoContent.innerHTML = `
                <div class="info-title">${info.title}</div>
                ${searchContextHTML}
                <div class="info-text">${info.description}</div>
                <div class="info-text">${info.details}</div>
                <div class="region-stats">
                    <h3 style="margin-bottom: 15px; color: #2c3e50;">Historic Details</h3>
                    ${Object.keys(info.stats).map(stat => `
                        <div class="stat-item">
                            <span class="stat-label">${stat}:</span>
                            <span class="stat-value">${info.stats[stat]}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="info-text"><strong>Modern Features:</strong> ${info.features}</div>
            `;
        }

        function showLoading() {
            const infoContent = document.getElementById('infoContent');
            infoContent.innerHTML = '<div class="loading">Searching for address</div>';
        }

        function showError(message) {
            const infoContent = document.getElementById('infoContent');
            infoContent.innerHTML = `<div class="error"><strong>Error:</strong> ${message}</div>`;
        }

        function showNoRegionFound(address, lat, lng) {
            const infoContent = document.getElementById('infoContent');
            infoContent.innerHTML = `
                <div class="info-title">Location Found</div>
                <div class="coordinates-info">
                    <strong>📍 Address:</strong><br>${address}<br>
                    <small>Coordinates: ${lat.toFixed(6)}, ${lng.toFixed(6)}</small>
                </div>
                <div class="info-text">
                    This location is outside of the historic Mexican land grant boundaries shown on this map.
                </div>
                <div class="info-text">
                    The colored regions represent the original ranchos granted during the Mexican period (1821-1848). 
                    Your searched location may be in an area that was not part of these historic land grants.
                </div>
                <div class="search-suggestion">
                    <div class="suggestion-title">💡 Try these suggestions:</div>
                    • Search for addresses within the colored regions<br>
                    • Click directly on any colored region to learn about that rancho<br>
                    • Try searching for well-known locations like "San Rafael, CA" or "Novato, CA"
                </div>
            `;
        }

        // Add keyboard shortcuts and additional interactions
        document.addEventListener('keydown', function(e) {
            // Press 'Escape' to clear highlights and reset view
            if (e.key === 'Escape') {
                clearHighlight();
                if (currentMarker) {
                    map.removeLayer(currentMarker);
                    currentMarker = null;
                }
                // Reset to default view
                map.setView([38.0834, -122.7633], 10);
                
                // Reset info panel to welcome message
                const infoContent = document.getElementById('infoContent');
                infoContent.innerHTML = `
                    <div class="info-title">Welcome to Regional Explorer</div>
                    <div class="info-text">
                        Enter any address in Marin County into the search box above to discover which historic rancho it belongs to.
                    </div>
                    <div class="info-text">
                        The map shows the original ranchos of Marin County with detailed information about each one.
                    </div>
                    <div class="info-text">
                        Click on any rancho polygon or search for an address to get detailed information!
                    </div>
                    <div class="info-text">
                        This system uses free OpenStreetMap data integrated using Leaflet.
                    </div>
                `;
            }
        });

        // Improve search input with suggestions
        document.getElementById('addressInput').addEventListener('input', function(e) {
            const value = e.target.value.toLowerCase();
            if (value.length > 2) {
                // Simple validation and suggestions could be added here
                // For now, we'll just ensure the input is clean
                this.value = this.value.replace(/[<>]/g, ''); // Basic XSS prevention
            }
        });

        // Add double-click to zoom functionality
        regions.forEach(region => {
            region.polygon.on('dblclick', function(e) {
                L.DomEvent.stopPropagation(e);
                map.fitBounds(region.polygon.getBounds(), { 
                    padding: [50, 50],
                    maxZoom: 14
                });
            });
        });

        // Initialize map when page loads
        document.addEventListener('DOMContentLoaded', initMap);

        // Add window resize handler to maintain map responsiveness
        window.addEventListener('resize', function() {
            if (map) {
                setTimeout(function() {
                    map.invalidateSize();
                }, 100);
            }
        });
    </script>
</body>
</html>
