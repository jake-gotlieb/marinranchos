<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regional Map Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .search-container {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .search-box {
            display: flex;
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 50px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.2);
        }
        
        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .main-content {
            display: flex;
            height: 600px;
        }
        
        .map-container {
            flex: 1;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .info-panel {
            width: 400px;
            background: white;
            border-left: 1px solid #e9ecef;
            overflow-y: auto;
        }
        
        .info-content {
            padding: 30px;
        }
        
        .info-title {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .info-text {
            color: #555;
            line-height: 1.8;
            margin-bottom: 20px;
        }
        
        .region-stats {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .stat-label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-value {
            color: #667eea;
            font-weight: bold;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }
        
        .loading::after {
            content: '';
            display: inline-block;
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        
        .error {
            color: #e74c3c;
            background: #fdf2f2;
            padding: 20px;
            border-radius: 10px;
            margin: 20px;
            border-left: 4px solid #e74c3c;
        }

        .search-suggestion {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #2196f3;
        }
        
        .suggestion-title {
            font-weight: bold;
            color: #1565c0;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Regional Map Explorer</h1>
            <p>Search for any address and discover which region it belongs to</p>
        </div>
        
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="addressInput" class="search-input" 
                       placeholder="Enter an address (e.g., 1125 B St, San Rafael)">
                <button id="searchBtn" class="search-btn">Search</button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="map-container">
                <div id="map"></div>
            </div>
            
            <div class="info-panel">
                <div class="info-content" id="infoContent">
                    <div class="info-title">Welcome to </div>
                    <div class="info-text">
                        Enter any address in Marin into the search box above to discover which rancho used to exist there. 
                        The map shows the original ranchos of Marin with detailed information about them all.
                    </div>
                    <div class="info-text">
                        Click on any rancho or search for an address to get detailed information!
                    </div>
                    <div class="info-text">
                        This system uses free OpenStreetMap data integrated using Leaflet.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
        let map;
        let regions = [];
        let currentMarker;
        let historicalOverlay;

        // Sample region data with polygons centered around NYC
        const regionData = {
            'Manhattan Downtown': {
                coordinates: [
                    [40.7589, -73.9851], [40.7585, -73.9845], [40.7580, -73.9848],
                    [40.7575, -73.9852], [40.7570, -73.9855], [40.7565, -73.9860],
                    [40.7560, -73.9865], [40.7555, -73.9870], [40.7550, -73.9875],
                    [40.7545, -73.9880], [40.7540, -73.9885], [40.7535, -73.9890],
                    [40.7530, -73.9895], [40.7525, -73.9900], [40.7520, -73.9905],
                    [40.7515, -73.9910], [40.7510, -73.9915], [40.7505, -73.9920],
                    [40.7500, -73.9925], [40.7495, -73.9930], [40.7490, -73.9925],
                    [40.7485, -73.9920], [40.7480, -73.9915], [40.7475, -73.9910],
                    [40.7470, -73.9905], [40.7475, -73.9900], [40.7480, -73.9895],
                    [40.7485, -73.9890], [40.7490, -73.9885], [40.7495, -73.9880],
                    [40.7500, -73.9875], [40.7505, -73.9870], [40.7510, -73.9865],
                    [40.7515, -73.9860], [40.7520, -73.9855], [40.7525, -73.9850],
                    [40.7530, -73.9845], [40.7535, -73.9840], [40.7540, -73.9835],
                    [40.7545, -73.9830], [40.7550, -73.9825], [40.7555, -73.9820],
                    [40.7560, -73.9815], [40.7565, -73.9810], [40.7570, -73.9805],
                    [40.7575, -73.9800], [40.7580, -73.9795], [40.7585, -73.9800],
                    [40.7590, -73.9805], [40.7595, -73.9810], [40.7590, -73.9815],
                    [40.7585, -73.9820], [40.7590, -73.9825], [40.7595, -73.9830],
                    [40.7590, -73.9835], [40.7595, -73.9840], [40.7590, -73.9845]
                ],
                color: '#e74c3c',
                info: {
                    title: 'Manhattan Downtown District',
                    description: 'The bustling heart of Manhattan, Downtown represents the commercial and financial center of New York City. This area is characterized by towering skyscrapers, busy streets, and a concentration of business activities.',
                    details: 'Home to Wall Street, numerous corporate headquarters, financial institutions, and government offices, the Downtown district serves as the economic engine of the region. The area features excellent public transportation connectivity with multiple subway lines.',
                    features: 'Key features include the Financial District, One World Trade Center, Stone Street Historic District, South Street Seaport, and Battery Park. The district maintains a vibrant atmosphere with historic sites alongside modern developments.',
                    stats: {
                        'Population Density': '74,781/sq mi',
                        'Average Building Height': '35 floors',
                        'Public Transit Score': '100/100',
                        'Business Establishments': '5,000+'
                    }
                }
            },
            'Manhattan Midtown': {
                coordinates: [
                    [40.7673, -73.9851],
                    [40.7589, -73.9851],
                    [40.7573, -73.9675],
                    [40.7657, -73.9675]
                ],
                color: '#27ae60',
                info: {
                    title: 'Manhattan Midtown',
                    description: 'The commercial heart of Manhattan, featuring iconic landmarks, Broadway theaters, and world-famous attractions. This area represents the cultural and entertainment center of New York City.',
                    details: 'Midtown Manhattan is home to Times Square, the Theater District, Empire State Building, and countless corporate offices. The area buzzes with activity 24/7, attracting millions of visitors annually.',
                    features: 'Notable features include Broadway shows, world-class shopping on Fifth Avenue, Rockefeller Center, Central Park proximity, and the highest concentration of skyscrapers in the world.',
                    stats: {
                        'Daily Visitors': '750,000+',
                        'Broadway Theaters': '41',
                        'Annual Tourism': '$45B',
                        'Hotel Rooms': '115,000+'
                    }
                }
            },
            'Brooklyn Heights': {
                coordinates: [
                    [40.7505, -73.9934],
                    [40.7421, -74.0017],
                    [40.7405, -73.9841],
                    [40.7489, -73.9758]
                ],
                color: '#f39c12',
                info: {
                    title: 'Brooklyn Heights Historic District',
                    description: 'A charming historic neighborhood offering stunning views of Manhattan across the East River. Known for its 19th-century architecture and tree-lined promenade.',
                    details: 'Brooklyn Heights is Americas first historic district, featuring beautifully preserved brownstones and the famous Brooklyn Heights Promenade. The area offers a more residential feel while maintaining proximity to Manhattan.',
                    features: 'Highlights include the Brooklyn Heights Promenade with panoramic Manhattan views, historic brownstone architecture, Brooklyn Bridge Park, and quaint neighborhood cafes and shops.',
                    stats: {
                        'Historic Buildings': '600+',
                        'Promenade Length': '1,826 ft',
                        'Median Home Value': '$1.2M',
                        'Walkability Score': '88/100'
                    }
                }
            },
            'Lower East Side': {
                coordinates: [
                    [40.7573, -73.9675],
                    [40.7489, -73.9758],
                    [40.7473, -73.9582],
                    [40.7557, -73.9499]
                ],
                color: '#9b59b6',
                info: {
                    title: 'Lower East Side Cultural Hub',
                    description: 'A vibrant cultural melting pot with rich immigrant history, trendy galleries, music venues, and diverse dining scene. This neighborhood embodies New York\'s creative spirit.',
                    details: 'The Lower East Side has transformed from a working-class immigrant neighborhood into a trendy cultural destination while preserving its historic character. The area attracts artists, musicians, and food enthusiasts.',
                    features: 'Cultural highlights include the Tenement Museum, music venues like Mercury Lounge and Bowery Ballroom, vintage shops, artisanal food markets, and some of the city\'s best nightlife.',
                    stats: {
                        'Art Galleries': '150+',
                        'Music Venues': '25+',
                        'Restaurants': '400+',
                        'Cultural Events/Year': '500+'
                    }
                }
            }
        };

        function initMap() {
            // Initialize map centered on NYC
            map = L.map('map').setView([38.0834, -122.7633], 10);

            // Add OpenStreetMap tile layer (completely free)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            const historicalBounds = [
                [40.7400, -74.0100], // Southwest corner
                [40.7700, -73.9700]  // Northeast corner
            ];
            
            // Replace this URL with your historical map image
            historicalOverlay = L.imageOverlay(
                '/6223743031_813d5420e3_b-1418050841 (1).webp',
                historicalBounds,
                {
                    opacity: 0.7,
                    interactive: false
                }
            );

            // Create region polygons
            Object.keys(regionData).forEach(regionName => {
                const region = regionData[regionName];
                const polygon = L.polygon(region.coordinates, {
                    color: region.color,
                    weight: 3,
                    opacity: 0.8,
                    fillColor: region.color,
                    fillOpacity: 0.2
                }).addTo(map);

                regions.push({
                    name: regionName,
                    polygon: polygon,
                    data: region
                });

                // Add click listener to polygon
                polygon.on('click', () => {
                    showRegionInfo(regionName, region.info);
                });

                // Add popup on hover
                polygon.bindTooltip(regionName, {
                    permanent: false,
                    direction: 'center'
                });
            });

            // Search functionality
            document.getElementById('searchBtn').addEventListener('click', searchAddress);
            document.getElementById('addressInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchAddress();
                }
            });
        }

        async function searchAddress() {
            const address = document.getElementById('addressInput').value;
            if (!address) {
                alert('Please enter an address');
                return;
            }

            showLoading();

            try {
                // Use Nominatim (OpenStreetMap's free geocoding service)
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1`);
                const data = await response.json();

                if (data && data.length > 0) {
                    const lat = parseFloat(data[0].lat);
                    const lng = parseFloat(data[0].lon);
                    const displayName = data[0].display_name;

                    // Clear previous marker
                    if (currentMarker) {
                        map.removeLayer(currentMarker);
                    }

                    // Add marker
                    currentMarker = L.marker([lat, lng])
                        .addTo(map)
                        .bindPopup(displayName)
                        .openPopup();

                    // Center map on result
                    map.setView([lat, lng], 15);

                    // Check which region contains this point
                    const foundRegion = findRegionContainingPoint(lat, lng);
                    
                    if (foundRegion) {
                        showRegionInfo(foundRegion.name, foundRegion.data.info, displayName);
                        // Highlight the found region
                        foundRegion.polygon.setStyle({
                            weight: 5,
                            opacity: 1,
                            fillOpacity: 0.4
                        });
                        setTimeout(() => {
                            foundRegion.polygon.setStyle({
                                weight: 3,
                                opacity: 0.8,
                                fillOpacity: 0.2
                            });
                        }, 3000);
                    } else {
                        showNoRegionFound(displayName);
                    }
                } else {
                    showError('Address not found. Please try a different search term.');
                }
            } catch (error) {
                showError('Search failed. Please check your internet connection and try again.');
                console.error('Geocoding error:', error);
            }
        }

        function findRegionContainingPoint(lat, lng) {
            for (let region of regions) {
                if (isPointInPolygon(lat, lng, region.data.coordinates)) {
                    return region;
                }
            }
            return null;
        }

        function isPointInPolygon(lat, lng, coordinates) {
            let inside = false;
            for (let i = 0, j = coordinates.length - 1; i < coordinates.length; j = i++) {
                const xi = coordinates[i][0];
                const yi = coordinates[i][1];
                const xj = coordinates[j][0];
                const yj = coordinates[j][1];

                if (((yi > lng) !== (yj > lng)) && (lat < (xj - xi) * (lng - yi) / (yj - yi) + xi)) {
                    inside = !inside;
                }
            }
            return inside;
        }

        function showRegionInfo(regionName, info, searchAddress = null) {
            const infoContent = document.getElementById('infoContent');
            
            infoContent.innerHTML = `
                <div class="info-title">${info.title}</div>
                ${searchAddress ? `<div class="info-text"><strong>Searched Address:</strong> ${searchAddress}</div>` : ''}
                <div class="info-text">${info.description}</div>
                <div class="info-text">${info.details}</div>
                <div class="region-stats">
                    <h3 style="margin-bottom: 15px; color: #2c3e50;">Region Statistics</h3>
                    ${Object.keys(info.stats).map(stat => `
                        <div class="stat-item">
                            <span class="stat-label">${stat}:</span>
                            <span class="stat-value">${info.stats[stat]}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="info-text">${info.features}</div>
            `;
        }

        function showLoading() {
            const infoContent = document.getElementById('infoContent');
            infoContent.innerHTML = '<div class="loading">Searching for address</div>';
        }

        function showError(message) {
            const infoContent = document.getElementById('infoContent');
            infoContent.innerHTML = `<div class="error">${message}</div>`;
        }

        function showNoRegionFound(address) {
            const infoContent = document.getElementById('infoContent');
            infoContent.innerHTML = `
                <div class="info-title">Location Found</div>
                <div class="info-text"><strong>Address:</strong> ${address}</div>
                <div class="info-text">This location is outside of our defined regions. The marker shows the exact location on the map.</div>
                <div class="info-text">Try searching for addresses within the colored regions to get detailed regional information, or click directly on any colored region.</div>
            `;
        }

        // Initialize map when page loads
        document.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>
</html>
